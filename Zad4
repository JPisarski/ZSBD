-- zadanie 1

SELECT employee_id, first_name, last_name, salary,
RANK() OVER (ORDER BY salary DESC) AS ranking_pensji
FROM employees;

--zadanie 2

SELECT employee_id, first_name, last_name, salary,
SUM(salary) OVER () AS suma_pensji
FROM employees;

-- zadanie 3

CREATE TABLE SALES AS SELECT * FROM HR.SALES;
ALTER TABLE SALES ADD PRIMARY KEY(SALE_ID);
ALTER TABLE SALES ADD FOREIGN KEY(EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID);
ALTER TABLE SALES ADD FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID);
CREATE TABLE JOB_GRADES AS SELECT * FROM HR.JOB_GRADES;
ALTER TABLE JOB_GRADES ADD PRIMARY KEY(GRADE);
CREATE TABLE PRODUCTS AS SELECT * FROM HR.PRODUCTS;
ALTER TABLE PRODUCTS ADD PRIMARY KEY(PRODUCT_ID);

SELECT e.last_name, p.product_name, SUM(s.QUANTITY * s.PRICE) AS calosc_sprzedazy,
RANK() OVER (ORDER BY SUM(s.quantity * s.price) DESC) AS ranking_sprzedazy
FROM sales s JOIN employees e ON s.employee_id = e.employee_id
JOIN products p ON s.product_id = p.product_id
GROUP BY e.last_name, p.product_name;

-- zadanie 4

SELECT e.last_name, p.product_name, s.price, COUNT(*) OVER(PARTITION BY p.product_id, s.sale_date) AS transakcja_danego_dnia,
SUM(s.quantity * s.price) OVER (PARTITION BY p.product_id, s.sale_date) as cala_wartosc_danego_dnia,
LAG(s.price) OVER (PARTITION BY p.product_id ORDER BY s.sale_date) AS poprzednia_cena,
LEAD(s.price) OVER (PARTITION BY p.product_id ORDER BY s.sale_date) as nastepna_cena
FROM sales s
JOIN employees e ON s.employee_id = e.employee_id
JOIN products p ON s.product_id = p.product_id;

-- zadanie 5

SELECT p.product_name, s.price, TRUNC(s.sale_date, 'MM') as miesiac,
SUM(s.quantity * s.price) OVER (PARTITION BY p.product_id, TRUNC(s.sale_date, 'MM')) AS calosc_miesiecznie,
SUM(s.quantity * s.price) OVER (PARTITION BY p.product_id, TRUNC(s.sale_date , 'MM') ORDER BY s.sale_date ROWS BETWEEN unbounded preceding AND CURRENT ROW) AS suma_rosnaca_miesiecznie
FROM sales s JOIN products p ON s.product_id = p.product_id;

-- zadanie 6

SELECT p.product_name, p.product_category, s2022.price as cena_2022, s2023.price as cena_2023, (s2023.price - s2022.price) as roznica
FROM sales s2022 JOIN sales s2023 ON s2022.product_id = s2023.product_id
AND EXTRACT(MONTH FROM s2022.sale_date) = EXTRACT(MONTH FROM s2023.sale_date)
AND EXTRACT(DAY FROM s2022.sale_date) = EXTRACT(DAY FROM s2023.sale_date)
JOIN products p ON s2022.product_id = p.product_id
WHERE EXTRACT(YEAR FROM s2022.sale_date) = 2022 AND EXTRACT(YEAR FROM s2023.sale_date) = 2023;

-- zadanie 7

