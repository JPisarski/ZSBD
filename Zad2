-- zadanie I

DROP TABLE DEPARTMENTS;
DROP TABLE EMPLOYEES;
DROP TABLE JOB_HISTORY;
DROP TABLE JOBS;
DROP TABLE LOCATIONS;
DROP TABLE COUNTRIES;
DROP TABLE REGIONS;

-- zadanie II

CREATE TABLE DEPARTMENTS AS SELECT * FROM HR.DEPARTMENTS;
CREATE TABLE EMPLOYEES AS SELECT * FROM HR.EMPLOYEES;
CREATE TABLE JOB_HISTORY AS SELECT * FROM HR.JOB_HISTORY;
CREATE TABLE JOBS AS SELECT * FROM HR.JOBS;
CREATE TABLE LOCATIONS AS SELECT * FROM HR.LOCATIONS;
CREATE TABLE COUNTRIES AS SELECT * FROM HR.COUNTRIES;
CREATE TABLE REGIONS AS SELECT * FROM HR.REGIONS;
ALTER TABLE REGIONS ADD PRIMARY KEY(region_id);
ALTER TABLE COUNTRIES ADD PRIMARY KEY(country_id);
ALTER TABLE LOCATIONS ADD PRIMARY KEY(location_id);
ALTER TABLE JOBS ADD PRIMARY KEY(job_id);
ALTER TABLE DEPARTMENTS ADD PRIMARY KEY(department_id);
ALTER TABLE EMPLOYEES ADD PRIMARY KEY(employee_id);
ALTER TABLE JOB_HISTORY ADD CONSTRAINT PK_JOB_HISTORY PRIMARY KEY (employee_id, start_date);
ALTER TABLE COUNTRIES ADD FOREIGN KEY(region_id) REFERENCES REGIONS(region_id);
ALTER TABLE LOCATIONS ADD FOREIGN KEY(country_id) REFERENCES COUNTRIES(country_id);
ALTER TABLE DEPARTMENTS ADD FOREIGN KEY(manager_id) REFERENCES EMPLOYEES(employee_id);
ALTER TABLE DEPARTMENTS ADD FOREIGN KEY(location_id) REFERENCES LOCATIONS(location_id);
ALTER TABLE EMPLOYEES ADD FOREIGN KEY(job_id) REFERENCES JOBS(job_id);
ALTER TABLE EMPLOYEES ADD FOREIGN KEY(department_id) REFERENCES DEPARTMENTS(department_id);
ALTER TABLE EMPLOYEES ADD FOREIGN KEY(manager_id) REFERENCES EMPLOYEES(employee_id);
ALTER TABLE JOB_HISTORY ADD FOREIGN KEY(employee_id) REFERENCES EMPLOYEES(employee_id);
ALTER TABLE JOB_HISTORY ADD FOREIGN KEY(job_id) REFERENCES JOBS(job_id);

-- zadanie III

--  zadanie 1

SELECT LAST_NAME || ' ' || SALARY AS WYNAGRODZENIE FROM EMPLOYEES WHERE DEPARTMENT_ID IN(20, 50) AND SALARY BETWEEN 2000 AND 7000 ORDER BY LAST_NAME;

-- zadanie 2

SELECT e.hire_date AS data_zatrudniena, e.last_name AS nazwisko, m.last_name AS nazwisko_menadżera 
FROM employees e JOIN employees m on e.manager_id = m.employee_id 
WHERE EXTRACT(YEAR FROM e.hire_date) = 2005 ORDER BY e.hire_date;

--  zadanie 3

SELECT first_name || ' ' || last_name AS imie_nazwisko, salary AS zarobki, phone_number AS telefon
FROM employees WHERE SUBSTR(last_name, 3, 1) = 'e' AND first_name LIKE '%Jo%' ORDER BY 1 DESC, 2 ASC;

--  zadanie 4

SELECT first_name || ' ' || last_name AS imie_nazwisko, ROUND(MONTHS_BETWEEN(SYSDATE, hire_date)) AS l_miesiecy,
CASE
WHEN MONTHS_BETWEEN(SYSDATE, hire_date) <= 150 THEN salary * 0.1
WHEN MONTHS_BETWEEN(SYSDATE, hire_date) BETWEEN 151 AND 200 THEN salary * 0.2
WHEN MONTHS_BETWEEN(SYSDATE, hire_date) > 200 THEN salary * 0.3
END AS wysokosc_dodatku
FROM employees ORDER BY l_miesiecy;

--  zadanie 5

SELECT department_id, SUM(salary) AS suma_zarobków, ROUND(AVG(salary)) AS średnia_zarobków
FROM employees GROUP BY department_id HAVING MIN(salary) > 5000 ORDER BY department_id;

--  zadanie 6

SELECT e.last_name, e.department_id, d.department_name, e.job_id
FROM employees e JOIN departments d ON e.department_id = d.department_id
JOIN locations l ON d.location_id = l.location_id WHERE l.city = 'Toronto';

--  zadanie 7

SELECT e.first_name || ' ' || e.last_name AS imie_nazwisko, c.first_name || ' ' || c.last_name AS współpracownik
FROM employees e JOIN employees c ON e.department_id = c.department_id 
WHERE e.first_name = 'Jennifer' AND e.employee_id != c.employee_id;

--  zadanie 8

SELECT d.department_id, d.department_name FROM departments d
LEFT JOIN employees e ON d.department_id = e.department_id
WHERE e.employee_id IS NULL;

--  zadanie 9

SELECT e.first_name || ' ' || e.last_name AS imie_nazwisko, e.job_id, d.department_name, e.salary, g.grade 
FROM employees e JOIN departments d ON e.department_id = d.department_id JOIN job_grades g ON e.salary BETWEEN g.min_salary AND g.max_salary;

--  zadanie 10

SELECT e.first_name || ' ' || e.last_name AS imie_nazwisko, e.salary FROM employees e
WHERE e.salary > (SELECT AVG(salary) FROM employees) ORDER BY e.salary DESC;

--  zadanie 11

SELECT e.employee_id, e.first_name || ' ' || e.last_name AS imie_nazwisko FROM employees e
WHERE e.department_id IN (SELECT DISTINCT department_id FROM employees WHERE last_name LIKE '%u%');

--  zadanie 12

SELECT e.first_name || ' ' || e.last_name AS imie_nazwisko, ROUND(MONTHS_BETWEEN(SYSDATE, hire_date)) AS l_miesiecy FROM employees e
WHERE MONTHS_BETWEEN(SYSDATE, hire_date) > (SELECT AVG(MONTHS_BETWEEN(SYSDATE, hire_date)) FROM employees) ORDER BY l_miesiecy DESC;

--  zadanie 13

SELECT d.department_name, COUNT(e.employee_id) AS l_pracowników, ROUND(AVG(e.salary)) AS średnie_wynagrodzenie
FROM departments d LEFT JOIN employees e ON d.department_id = e.department_id GROUP BY d.department_name ORDER BY l_pracowników DESC; 

--  zadanie 14

SELECT e.first_name || ' ' || e.last_name AS imie_nazwisko FROM employees e
WHERE e.salary < (SELECT MIN(e1.salary) FROM employees e1 JOIN departments d on e1.department_id = d.department_id
WHERE d.department_name = 'IT') ORDER BY e.salary;

--  zadanie 15

SELECT DISTINCT d.department_name FROM employees e JOIN departments d ON e.department_id = d.department_id
WHERE e.salary > (SELECT AVG(e1.salary) FROM employees e1) ORDER BY d.department_name;

--  zadanie 16



--  zadanie 17

--  zadanie 18

--  zadanie 19

--  zadanie 20
