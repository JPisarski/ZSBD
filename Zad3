-- zadanie 1

CREATE VIEW v_wysokie_pensje AS
Select
    e.FIRST_NAME, e.LAST_NAME, e.SALARY
FROM
employees e WHERE
e.SALARY > 6000;

-- zadanie 2

CREATE OR REPLACE VIEW v_wysokie_pensje AS
Select
    e.FIRST_NAME, e.LAST_NAME, e.SALARY
FROM
employees e WHERE
e.SALARY > 12000;

-- zadanie 3

DROP VIEW v_wysokie_pensje;

-- zadanie 4

CREATE OR REPLACE VIEW v_employee AS
SELECT
    e.EMPLOYEE_ID, e.LAST_NAME, e.FIRST_NAME, d.DEPARTMENT_NAME
FROM
    EMPLOYEES e
INNER JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
WHERE d.DEPARTMENT_NAME = 'Finance';

-- zadanie 5

CREATE OR REPLACE VIEW v_employee_extended AS
SELECT
    e.EMPLOYEE_ID, e.LAST_NAME, e.FIRST_NAME, e.SALARY, e.JOB_ID, e.EMAIL , e.HIRE_DATE 
FROM
    EMPLOYEES e
WHERE
    e.SALARY BETWEEN 5000 AND 12000;
    
-- zadanie 6

-- a) można dodać nowego pracownika

INSERT INTO v_employee_extended (employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (2007, 'Nowak', 'Jan', 10000, 'IT_PROG', 'jan@gmail.com', '25/10/25');

-- b) można edytować pracownika

UPDATE v_employee_extended
SET last_name = 'Józef'
WHERE employee_id = 2007;

-- c) można usunąć pracownika

DELETE FROM v_employee_extended
WHERE employee_id = 2007;

-- zadanie 7

CREATE OR REPLACE VIEW v_extended AS
SELECT
    d.DEPARTMENT_ID, d.DEPARTMENT_NAME, 
    (SELECT COUNT(*) 
     FROM EMPLOYEES e 
     WHERE e.DEPARTMENT_ID = d.DEPARTMENT_ID) AS EMPLOYEE_COUNT,
     (SELECT AVG(e.SALARY)
     FROM EMPLOYEES e
     WHERE e.DEPARTMENT_ID = d.DEPARTMENT_ID) as AVG_SALARY,
     (SELECT MAX(e.SALARY)
     FROM EMPLOYEES e
     WHERE e.DEPARTMENT_ID = d.DEPARTMENT_ID) as MAX_SALARY     
FROM
    EMPLOYEES e
INNER JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
GROUP BY
    d.DEPARTMENT_ID, d.DEPARTMENT_NAME
HAVING
    COUNT(e.EMPLOYEE_ID) > 3;
    
-- a) nie można dodać danych do tego widoku

INSERT INTO v_extended (department_id, department_name, EMPLOYEE_COUNT, AVG_SALARY, MAX_SALARY)
VALUES (1, 'PR', 100, 25000, 250000);

-- zadanie 8

CREATE OR REPLACE VIEW v_employee_extended AS
SELECT
    e.EMPLOYEE_ID, e.LAST_NAME, e.FIRST_NAME, e.SALARY, e.JOB_ID, e.EMAIL , e.HIRE_DATE 
FROM
    EMPLOYEES e
WHERE
    e.SALARY BETWEEN 5000 AND 12000
WITH CHECK OPTION;

-- a) można dodać pracownika z zarobkami 10 000

INSERT INTO v_employee_extended (employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (2007, 'Nowak', 'Jan', 10000, 'IT_PROG', 'jan@gmail.com', '25/10/25');

-- b) nie można dodać pracownika z zarobkami 15 000

INSERT INTO v_employee_extended (employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (2500, 'Nowak', 'Jan', 15000, 'IT_PROG', 'jan@gmail.com', '25/10/25');

-- zadanie 9

CREATE MATERIALIZED VIEW v_managerowie AS
SELECT
e.*, d.DEPARTMENT_NAME
FROM
    EMPLOYEES e
INNER JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
WHERE d.MANAGER_ID = e.EMPLOYEE_ID;

-- zadanie 10

CREATE VIEW v_najlepiej_oplacani AS
SELECT
e.*
FROM
    EMPLOYEES e
ORDER by e.SALARY DESC
FETCH FIRST 10 ROWS ONLY;
